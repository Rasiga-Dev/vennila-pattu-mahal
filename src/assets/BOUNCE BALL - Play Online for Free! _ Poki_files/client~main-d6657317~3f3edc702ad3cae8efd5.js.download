try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="1a4bbe66-961a-473a-b179-7179d8de6898",e._sentryDebugIdIdentifier="sentry-dbid-1a4bbe66-961a-473a-b179-7179d8de6898")}catch(e){}("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{}).SENTRY_RELEASE={id:"9cbac7ae26bc931e29ae66af5616acaae6d35ef5"};(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([[5674],{18864:(e,t,a)=>{a.d(t,{Ay:()=>v,rv:()=>p});var o=a(20038),n=a(34524),s=a(5298),i=a(8811),r=a(89625),c=a(16536);const d=["immersiveTakeover","custom","base"],l={immersiveTakeover:null,custom:i.V.default},u=(0,o.Z0)({name:"background",initialState:l,reducers:{unsetBackground:()=>l,setBackground:(e,t)=>{const{layer:a,background:o}=t.payload;e[a]=o}},selectors:{selectBackground:e=>{let t=i.V.default;return Object.values(d).some((a=>!!e[a]&&(t=e[a],!0))),"string"==typeof t?t:{...t}},selectIsImmersiveTakeover:e=>null!==e.immersiveTakeover}}),{unsetBackground:m,setBackground:g}=u.actions,{selectBackground:p,selectIsImmersiveTakeover:f}=u.selectors;(0,c.Zv)({type:s.yc.type,effect:(e,t)=>{const a=t.getState(),o=(0,s.K5)(a),n=p(a);if(!n?.sticky)if("preview"!==o)if("mystery"!==o)if("game"!==o)if("category"!==o)t.dispatch(m());else{const e=(0,s.N2)(a),o=(0,r.r)(e.id);t.dispatch(g({layer:"custom",background:o}))}else{const e=(0,s.Vv)(a),o=(0,r.P)(e);t.dispatch(g({layer:"custom",background:o}))}else{const{mystery:e}=i.V;t.dispatch(g({layer:"custom",background:e}))}else{const{preview:e}=i.V;t.dispatch(g({layer:"custom",background:e}))}}}),(0,c.Zv)({type:n.jO.type,effect:(e,t)=>{const{background:a}=e?.payload?.takeover?.config||{};a&&t.dispatch(g({layer:"immersiveTakeover",background:{...a,style:"dual-cover"}}))}}),(0,c.Zv)({type:n.jp.type,effect:(e,t)=>{t.dispatch(m())}});const v=u.reducer},42891:(e,t,a)=>{a.d(t,{Ay:()=>$,F8:()=>u,Fe:()=>G,H6:()=>P,Jj:()=>x,KM:()=>L,Kk:()=>U,Kn:()=>z,Mh:()=>V,Pl:()=>b,Rd:()=>O,SG:()=>d,W3:()=>B,Wv:()=>R,Xy:()=>l,Y1:()=>m,ac:()=>C,hG:()=>w,nx:()=>h,oJ:()=>T,pX:()=>S,qk:()=>I,rk:()=>D,vR:()=>F,wu:()=>_,xp:()=>E,zO:()=>N,zS:()=>M,zj:()=>A});var o=a(20038),n=a(25508),s=a(36774),i=a(91323);const r={bot:!1,cache:0,device:"desktop",isIpadOS:!1,isIos:!1,visibility:!0,history:[],geo:"NL",region:"NH",ccpaApplies:!1,host:"poki.com",viewportOrientation:"portrait",loadingPage:!1,recentGames:[],hydrated:!1,asyncEpicFired:!1,consentStatus:void 0,usPrivacyString:"1---",consistentRandomSeed:Math.random(),externalGames:{},isAdsBlockedVisible:!1,trafficSource:null},c=(0,o.Z0)({name:"client",initialState:r,reducers:{hydrated:e=>{e.hydrated=!0},fireAsyncEpics:e=>{e.asyncEpicFired=!0},setConsentStatus:(e,t)=>{e.consentStatus=t.payload.consentStatus},setUSPrivacyString:(e,t)=>{e.usPrivacyString=t.payload.usPrivacyString},setDevice:(e,t)=>{e.device=t.payload.device},setGeo:(e,t)=>{e.geo=t.payload.geo},setRegion:(e,t)=>{e.region=t.payload.region},setTrafficSource:(e,t)=>{e.trafficSource=t.payload.trafficSource},setHost:(e,t)=>{e.host=t.payload.host},setViewportOrientation:(e,t)=>{e.viewportOrientation=t.payload.orientation},storeRecentGame:(e,t)=>{const{recentGames:a,siteID:o}=t.payload;e.recentGames={...e.recentGames,[o]:a}},setConsistentRandomSeed:(e,t)=>{e.consistentRandomSeed=t.payload.rand},setConsentExternalHostedGame:(e,t)=>{const{gameId:a}=t.payload;e.externalGames={...e.externalGames,[a]:!0}},setAdsBlockedVisible:(e,t)=>{e.isAdsBlockedVisible=t.payload.isVisible}}}),{hydrated:d,fireAsyncEpics:l,setConsentStatus:u,setUSPrivacyString:m,setDevice:g,setGeo:p,setRegion:f,setTrafficSource:v,setHost:y,setViewportOrientation:h,storeRecentGame:S,setConsistentRandomSeed:k,setConsentExternalHostedGame:b,setAdsBlockedVisible:w}=c.actions;function _(e){return e.client.geo}function A(e){return e.client.region}function D(e){return e.client.viewportOrientation}const E=e=>e.client.device;function P(e){const{device:t}=e.client;return"tablet"===t||"mobile"===t}const T=e=>e.client.ccpaApplies,I=(0,n.Mz)((e=>e.client.geo),(e=>s._k.includes(e))),C=e=>e.client.loadingPage&&e.client.hydrated,G=(0,n.Mz)(i.Gd,(e=>e.client.recentGames),((e,t)=>e&&t&&t[e.id]?t[e.id]:[])),F=(0,n.Mz)(G,(e=>e.reduce(((e,t)=>e+t.pt),0))),O=e=>e.client.consistentRandomSeed,M=e=>e.client.isIpadOS,B=e=>e.client.isIos,z=e=>e.client.usPrivacyString;function L(e,t){const{externalGames:a}=e.client;return a[t]||!1}const x=e=>e.client.isAdsBlockedVisible,R=(0,n.Mz)((e=>e.client.consentStatus),T,I,((e,t,a)=>t||!a||e===s.T2)),V=e=>e.client.asyncEpicFired,N=e=>e.client.trafficSource,U=()=>{const e="undefined"!=typeof window&&window?.context?.session?.id;if(!e)return 100;let t=0;for(let a=0;a<e.length;a++)t+=e.charCodeAt(a);return t%100},$=c},48554:(e,t,a)=>{a.d(t,{Ay:()=>be,Br:()=>I,Co:()=>U,FK:()=>me,Kj:()=>ce,QE:()=>oe,QX:()=>se,Rk:()=>j,TQ:()=>B,UO:()=>ne,be:()=>ge,cD:()=>J,gO:()=>H,h8:()=>M,iG:()=>O,iw:()=>W,kK:()=>z,kj:()=>de,lT:()=>re,lh:()=>F,m$:()=>q,on:()=>V,pT:()=>ue,qA:()=>Q,u9:()=>L,vA:()=>X,wZ:()=>C,wj:()=>le,yd:()=>ae,yq:()=>G,zM:()=>ie});var o=a(20038),n=a(25508),s=a(5298),i=a(42891),r=a(79906),c=a(89385),d=a(40620),l=a(15203),u=a(25733),m=a(10179),g=a(40890),p=a(13150),f=a(46493),v=a(17782),y=a(16536),h=a(73934),S=a(83228),k=a(46278),b=a(65995),w=a(23038),_=a(61363);const A={isFullscreen:!1,wasFullscreen:!1,showAdStatus:!1,adStatusEvent:"",adDuration:0,adCurrentTime:0,loadingFinished:!1,lastCloudSaveTimestamp:0,mobileNavPosition:void 0},D=(0,k.T5)(),E=`${D}/players/gamesave`,P=`${D}/auth/issue-token`,T=(0,o.Z0)({name:"game",initialState:A,reducers:{setFullscreen:(e,t)=>{e.isFullscreen=t.payload.toggle,e.wasFullscreen=e.wasFullscreen||t.payload.toggle},setGameLoadingFinished:(e,t)=>{e.loadingFinished=t.payload},setPubHostData:(e,t)=>{const{gameId:a,data:o}=t.payload;e[a]={...e[a],pubHostData:o}},showAdStatus:e=>{e.showAdStatus=!0},hideAdStatus:e=>{e.showAdStatus=!1},setAdStatusEvent:(e,t)=>{e.adStatusEvent=t.payload.event},setAdDurationAndProgress:(e,t)=>{e.adDuration=t.payload.duration,e.adCurrentTime=t.payload.currentTime},setLastCloudSaveTimestamp:(e,t)=>{e.lastCloudSaveTimestamp=t.payload},setMobileNavPosition:(e,t)=>{const{topPercent:a,topPx:o}=t.payload;e.mobileNavPosition={topPercent:a,topPx:o}}},extraReducers:e=>{e.addCase(s.yc,(e=>{e.mobileNavPosition=void 0}))}}),I=(0,v.A)("game/boot"),C=(0,v.A)("game/receive_game_event"),G=(0,v.A)("game/receive_sdk_details"),F=(0,v.A)("game/request_full_screen"),O=(0,v.A)("game/pub_host_initialized"),M=(0,v.A)("game/set_poki_url_params"),B=(0,v.A)("game/receive_command"),z=(0,v.A)("game/generate_screenshot"),L=(0,v.A)("game/receive_screenshot"),x=(0,v.A)("game/receive_score"),R=(0,v.A)("game/forward_game_event"),V=(0,v.A)("game/fetch_save_game"),N=(0,o.VP)("game/mutate_save_game"),U=(0,v.A)("game/cloud_save_game_script_error"),$=(0,v.A)("game/poki_accounts_open_auth_panel"),K=(0,v.A)("game/poki_accounts_get_user_token"),Z=(0,v.A)("game/open_external_link"),{setFullscreen:H,setGameLoadingFinished:j,setPubHostData:W,showAdStatus:X,hideAdStatus:q,setAdStatusEvent:J,setAdDurationAndProgress:Q,setLastCloudSaveTimestamp:Y,setMobileNavPosition:ee}=T.actions,te=(0,n.Mz)(s.Vv,(e=>e.game),((e,t)=>t[e&&e.id]||{}));function ae(e){const t=te(e);return t?.pubHostData||null}function oe(e){const t=(0,s.Vv)(e);return!!t?.fullscreen}const ne=(0,n.Mz)(s.Vv,i.zS,s.K5,l.Bi,((e,t,a,o)=>"game"===a?"flash"===e?.file?.render_type||e?.alternative_game_enabled||t&&!e?.mobile_available:"mystery"===a&&!o)),se=e=>e.game.isFullscreen,ie=e=>e.game.wasFullscreen,re=e=>e.game.showAdStatus,ce=e=>e.game.adStatusEvent,de=e=>e.game.adDuration,le=e=>e.game.adCurrentTime,ue=e=>e.game.loadingFinished,me=e=>e.game.lastCloudSaveTimestamp,ge=e=>e.game.mobileNavPosition,pe={pubHostInitialized:O,[p.oQ]:C,[p.Oi]:G,[p.AU]:M,[p.zR]:B,[p.RC]:L,[p.Zf]:x,[p.vO]:R,[p.Kt]:$,[p.Xo]:K,[p.W2]:Z,[p.IW]:ee,fetchSaveGame:V,mutateSaveGame:N,SaveGameMigrator:!0},fe=["localhost","games.poki.com","game-cdn.poki.com"],ve=["pokiMessageEvent","pokiMessageDebug","SaveGameMigrator"];function ye({event:e,dispatch:t}){const a=function({event:e}){const{type:t}=e.data||{};if(!t||!pe[t])return!1;if("function"!=typeof pe[t]&&!ve.includes(t))return!1;const a=(0,g.aX)(e.origin)||"",o=fe.includes(a)||a.endsWith(".poki-gdn.com")||a.endsWith(".gdn.poki.com")||window.location.origin===e.origin,n=document.querySelector('iframe[name="gameFrame"]'),s=n&&n.src.startsWith(e.origin);return o||s}({event:e});if(!a)return;const{content:o,type:n}=e.data;if(ve.includes(n)&&(0,f.F)({category:"sdk",action:"message",data:{content:o,type:n}}),"function"==typeof pe[n]){const a=e.source;t(pe[n]({...o,source:a}))}}(0,y.Zv)({type:i.Xy.type,effect:(e,t)=>{const{dispatch:a}=t;void 0!==window.pokiMessageListener&&window.removeEventListener("message",window.pokiMessageListener),window.pokiMessageBuffer&&window.pokiMessageBuffer.forEach((e=>{ye({event:e,dispatch:a})})),window.addEventListener("message",(e=>{ye({event:e,dispatch:a})}))}});const he=(0,o.zD)("game/push_save_game_to_cloud",(async({gameID:e,saveGameData:t},a)=>{const o=t.playtime||0;try{const n=JSON.stringify({ls:t.ls,idb:t.idb}),s=new Blob([n]).size;let i=n,r=s,d=1,l=!0;try{i=await(0,h.B)(n),r=i.size,d=r/s}catch(e){l=!1,console.error(e)}if(console.info(`[SaveGame] Compression results - Original: ${s/1024}KB, Compressed: ${r/1024}KB, Compression ratio: ${(100*d).toFixed(2)}% of the original size`),r>S.Im)return console.error(`[SaveGame] Game file is too large after compression ${r/1048576}mb`),(0,f.F)({category:"account",action:"gamesaveSizeTooLarge",data:{gameId:e,size:r,originalSize:s,compressionRatio:d}}),void a.dispatch((0,c.hK)({gameID:e,saveGameSize:r}));const u={"X-Poki-Pt":o.toString(),"X-Poki-Api-Version":"v2"};l&&(u["Content-Encoding"]="gzip"),a.dispatch(Y(Date.now()));const m=await fetch(`${E}/${e}`,{method:"POST",body:i,credentials:"include",headers:u});if(!m.ok)throw new Error(`Failed to save user games: ${m.status}`);const g=m.headers.get("Etag");g&&window.frames?.gameFrame?.postMessage?.({type:"pokiSetEtag",etag:g},"*"),(0,f.F)({category:"account",action:"gamesaveSuccess",data:{gameId:e,size:r,originalSize:s,compressionRatio:d}});const p=new Date;console.info(`[SaveGame] cloud sync - game: ${e}, at: ${p.toLocaleString()}`)}catch(t){console.error("[SaveGame] error pushing to cloud",t),(0,f.F)({category:"account",action:"gamesaveError",data:{gameId:e,method:"pushSaveGameToCloud",context:"sending gamesave to the cloud",error:t instanceof Error?`${t.name}: ${t.message}`:String(t)}})}}));(0,y.Zv)({type:N.type,effect:(e,t)=>{const a=t.getState(),o=(0,s.Vv)(a)?.id,n=(0,c.Ep)(a),i=(0,c.Fh)(a);if(!n||!o||i.includes(o))return;if((0,S.jJ)(e.payload))return;const r={playtime:parseInt(e.payload.metadata?.playtime||"0",10),ls:e.payload.ls||"",idb:e.payload.idb||""};t.dispatch(he({gameID:o,saveGameData:r}))}});const Se=Math.random().toString(36).substring(2);(0,y.Zv)({actionCreator:c.hK,effect:(e,t)=>{const a=ae(t.getState()),{gameID:o,gameVersion:n}=a||{},s="LargeGameSave",i="Savegame is too large to sync to Poki User Account (max 1MB allowed)",r=JSON.stringify({gid:o,vid:n,ve:7,n:s,m:i,ui:Se}),c=`${k.N8}/ge`;fetch(c,{method:"POST",body:r})}}),(0,y.Zv)({type:$.type,effect:(e,t)=>{const a=t.getState(),o=(0,c.ij)(a),n=(0,s.Vv)(a)?.id,i=e.version||0;if(!o){let o="unknown";switch(i){case 0:o=`sdk-${n}`;break;case 1:o=e.trigger}t.dispatch((0,c.qf)({source:o})),(0,f.F)({category:"account",action:"sdkOpenAuthPanel",data:{source:o,gameID:(0,s.Vv)(a)?.id}})}}}),(0,y.Zv)({type:K.type,effect:async(e,t)=>{const a=t.getState(),o=(0,s.Vv)(a)?.pokifordevs_game_id,n=(0,c.Ep)(a),i=e=>{window.frames?.gameFrame?.postMessage?.({type:"pokiAccountsUserToken",token:null,error:e},"*")};if(!o)return void i("No gameID found");if(!n)return void i("User is not logged in");let r,d;try{r=await fetch(`${P}?game_id=${o}`,{method:"GET",credentials:"include"})}catch(e){return console.error(e),void i("Network error while generating token")}if(r.ok){try{d=await r.json()}catch{return void i("Failed to parse user token")}window.frames?.gameFrame?.postMessage?.({type:"pokiAccountsUserToken",token:d.token},"*")}else i("Failed to generate user token")}}),(0,y.Zv)({type:x.type,effect:(e,t)=>{const{leaderboard:a,score:o,timeOnPage:n}=e.data;let{meta:i}=e.data;const r=t.getState(),d=(0,s.Vv)(r);if(!d||!d.pokifordevs_game_id)return;const l=(0,c.IT)(r);i||(i={time_on_page:Math.round(n)}),(0,b.g)(a,o,i,d.pokifordevs_game_id,l?.identity?.id)}}),(0,y.Zv)({type:R.type,effect:e=>{if(window.pokiBotDetected?.length>0)return;const{payload:t}=e,a=(0,u.H)();t.pageview_id=a.page.pageview_id;const o=`${k.N8}/game-event`;fetch(o,{method:"POST",headers:{"Content-Type":"text/plain"},body:JSON.stringify(t),mode:"no-cors",keepalive:!0,credentials:"omit"}).catch((e=>{console.warn("%cPOKI:%c failed to submit game event","font-weight: bold","",e)}))}}),(0,y.Zv)({type:Z.type,effect:(e,t)=>{const{params:{url:a}}=e;if(a&&"string"==typeof a)try{const e=new URL(a);t.dispatch((0,r.mi)({modal:{id:_.HEADSUP_MODAL_ID,iconDesktop:"exclamation",iconMobile:"exclamationLarge",childComponent:{name:"modals/HeadsUpModal",props:{externalLinkURL:e.toString()}}}}))}catch{console.error("Invalid external link URL format:",a)}}});let ke=!1;(0,y.Zv)({predicate:e=>(0,o.i0)(m.sx.rejected,s.yc)(e)||e.type===C.type,effect:(e,{getState:t,dispatch:a})=>{if(m.sx.rejected.match(e)&&(ke=!0),!m.sx.rejected.match(e)&&!ke)return;if(e.type===C.type&&e.event!==p.zY)return;const o=t();if((0,c.Ep)(o))return;if(!((0,i.vR)(o)>=3600))return;const n=864e5;a((0,r.mi)({modal:{id:_.POWERUSER_MODAL_ID,iconDesktop:"clock",iconMobile:"clockLarge",showCloseButtonInHeader:!0,muteExpirationTime:[n,n,6048e5,2592e6],childComponent:{name:"modals/PowerUserModal"}}}))}}),(0,y.Zv)({predicate:e=>e.type===C.type&&e.event===p.zY,effect:(e,t)=>{const a=t.getState();if(!(0,c.Ep)(a))return void t.unsubscribe();const o=(0,c.C4)(a),n=(0,c.jv)(a);if(o)return t.dispatch((0,c.Bp)({showNotificationBubble:!1})),void t.unsubscribe();t.dispatch(w.lh.endpoints.getProfile.initiate({extraOptions:"/username/status"},{forceRefetch:!0})).then((e=>{const a=e?.data?.can_update_now;if(a&&(t.unsubscribe(),t.dispatch((0,c.Bp)({showNotificationBubble:!0})),t.dispatch((0,d.oK)({tooltip:{id:"usernameUnlocked",consumerId:"userAvatar",htmlContent:"<strong>User name unlocked.</strong><p>Try it out in your account.</p>",muteAfterClose:!0,showCloseButton:!0}})),n)){const e=window.innerWidth<=768;t.dispatch((0,d.oK)({tooltip:{id:"profileOverflow_username",consumerId:"profileOverflow",htmlContent:"User names available",muteAfterClose:!0,icon:"pencil",position:e?"left":"right"}}))}}))}});const be=T}}]);
//# sourceMappingURL=client~main-d6657317~3f3edc702ad3cae8efd5.js.map